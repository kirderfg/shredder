<!doctype html>
<html lang="sv">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="theme-color" content="#1a0a0a" />
    <title>SHREDDER - 30 Day Guitar Training</title>
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üé∏</text></svg>"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.3.2/pixi.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      :root {
        --fire-red: #ff4400;
        --fire-orange: #ff8800;
        --fire-yellow: #ffcc00;
        --metal-dark: #0a0505;
        --metal-gray: #1a1515;
        --metal-light: #2a2020;
        --blood-red: #8b0000;
        --skull-white: #e8e0d0;
        --chrome: #c0c0c0;
        --safe-top: env(safe-area-inset-top, 20px);
        --safe-bottom: env(safe-area-inset-bottom, 20px);
      }

      @font-face {
        font-family: "Metal";
        src: local("Impact"), local("Arial Black");
      }

      body {
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: var(--metal-dark);
        color: var(--skull-white);
        min-height: 100vh;
        overflow-x: hidden;
        position: relative;
      }

      #pixi-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
      }

      .app-container {
        position: relative;
        z-index: 1;
        min-height: 100vh;
        padding: calc(var(--safe-top) + 10px) 16px
          calc(var(--safe-bottom) + 80px) 16px;
      }

      /* Header with stats */
      .header {
        text-align: center;
        margin-bottom: 16px;
      }

      .logo {
        font-family: "Metal", Impact, sans-serif;
        font-size: 32px;
        letter-spacing: 4px;
        background: linear-gradient(
          180deg,
          var(--fire-yellow) 0%,
          var(--fire-orange) 50%,
          var(--fire-red) 100%
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        text-shadow: 0 0 20px rgba(255, 68, 0, 0.5);
        animation: flicker 0.5s ease-in-out infinite alternate;
      }

      @keyframes flicker {
        0% {
          filter: brightness(1);
        }
        100% {
          filter: brightness(1.2);
        }
      }

      .subtitle {
        font-size: 11px;
        color: var(--chrome);
        letter-spacing: 2px;
        margin-top: 4px;
      }

      /* Stats Bar */
      .stats-bar {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        margin: 16px 0;
      }

      .stat-box {
        background: linear-gradient(
          145deg,
          var(--metal-gray),
          var(--metal-dark)
        );
        border: 1px solid var(--blood-red);
        border-radius: 8px;
        padding: 10px 8px;
        text-align: center;
      }

      .stat-icon {
        font-size: 20px;
        display: block;
      }

      .stat-value {
        font-family: "Metal", Impact, sans-serif;
        font-size: 18px;
        color: var(--fire-orange);
        margin: 4px 0 2px;
      }

      .stat-label {
        font-size: 9px;
        color: var(--chrome);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      /* Level Progress */
      .level-section {
        background: linear-gradient(
          145deg,
          var(--metal-gray),
          var(--metal-dark)
        );
        border: 1px solid var(--blood-red);
        border-radius: 12px;
        padding: 12px;
        margin-bottom: 16px;
      }

      .level-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .level-title {
        font-family: "Metal", Impact, sans-serif;
        font-size: 14px;
        color: var(--fire-orange);
      }

      .level-rank {
        font-size: 12px;
        color: var(--skull-white);
      }

      .xp-bar-container {
        background: var(--metal-dark);
        border-radius: 10px;
        height: 20px;
        overflow: hidden;
        border: 1px solid #333;
      }

      .xp-bar {
        height: 100%;
        background: linear-gradient(
          90deg,
          var(--blood-red),
          var(--fire-red),
          var(--fire-orange)
        );
        border-radius: 10px;
        transition: width 0.5s ease;
        position: relative;
      }

      .xp-bar::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 50%;
        background: linear-gradient(
          180deg,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        border-radius: 10px 10px 0 0;
      }

      .xp-text {
        text-align: center;
        font-size: 11px;
        margin-top: 6px;
        color: var(--chrome);
      }

      /* Day Card */
      .day-card {
        background: linear-gradient(
          145deg,
          var(--metal-light),
          var(--metal-gray)
        );
        border: 2px solid var(--blood-red);
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 16px;
        position: relative;
        overflow: hidden;
      }

      .day-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--fire-red),
          var(--fire-orange),
          var(--fire-yellow),
          var(--fire-orange),
          var(--fire-red)
        );
      }

      .day-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
      }

      .day-number {
        font-family: "Metal", Impact, sans-serif;
        font-size: 24px;
        color: var(--fire-orange);
      }

      .day-date {
        font-size: 11px;
        color: var(--chrome);
      }

      .guitarist-badge {
        display: flex;
        align-items: center;
        gap: 8px;
        background: var(--metal-dark);
        padding: 6px 10px;
        border-radius: 20px;
        border: 1px solid var(--blood-red);
      }

      .guitarist-avatar {
        width: 28px;
        height: 28px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 16px;
        background: var(--metal-gray);
      }

      .guitarist-name {
        font-size: 11px;
        font-weight: bold;
      }

      .day-title {
        font-family: "Metal", Impact, sans-serif;
        font-size: 16px;
        margin-bottom: 12px;
        color: var(--skull-white);
      }

      /* Training Sections */
      .training-section {
        margin-bottom: 16px;
      }

      .training-section-title {
        font-family: "Metal", Impact, sans-serif;
        font-size: 12px;
        color: var(--fire-orange);
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 6px;
      }

      .training-list {
        list-style: none;
        background: var(--metal-dark);
        border-radius: 8px;
        padding: 12px;
      }

      .training-list li {
        font-size: 13px;
        line-height: 1.5;
        padding: 6px 0;
        border-bottom: 1px solid rgba(139, 0, 0, 0.2);
        padding-left: 16px;
        position: relative;
      }

      .training-list li:last-child {
        border-bottom: none;
        padding-bottom: 0;
      }

      .training-list li:first-child {
        padding-top: 0;
      }

      .training-list li::before {
        content: "‚ñ∏";
        position: absolute;
        left: 0;
        color: var(--fire-orange);
      }

      /* Guitar Tab Section */
      .lick-section {
        background: var(--metal-dark);
        border: 1px solid var(--blood-red);
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 16px;
      }

      .lick-tab {
        font-family: "Courier New", monospace;
        font-size: 11px;
        line-height: 1.4;
        color: var(--fire-yellow);
        white-space: pre;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      /* Complete Day Button */
      .complete-day-btn {
        width: 100%;
        padding: 16px;
        border: none;
        border-radius: 12px;
        font-family: "Metal", Impact, sans-serif;
        font-size: 16px;
        cursor: pointer;
        transition: all 0.2s;
        margin-top: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      .complete-day-btn.incomplete {
        background: linear-gradient(
          145deg,
          var(--fire-orange),
          var(--fire-red)
        );
        color: var(--skull-white);
      }

      .complete-day-btn.completed {
        background: linear-gradient(145deg, #2d5a27, #1a3d15);
        color: var(--skull-white);
        border: 2px solid #4a9e42;
      }

      .complete-day-btn:active {
        transform: scale(0.98);
      }

      .xp-badge {
        background: rgba(0, 0, 0, 0.3);
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 12px;
      }

      /* Quote Section */
      .quote-section {
        background: var(--metal-dark);
        border-left: 3px solid var(--fire-orange);
        padding: 12px;
        margin-top: 16px;
        border-radius: 0 8px 8px 0;
      }

      .quote-text {
        font-style: italic;
        font-size: 12px;
        line-height: 1.5;
        color: var(--skull-white);
        margin-bottom: 8px;
      }

      .quote-author {
        font-size: 11px;
        color: var(--fire-orange);
        font-weight: bold;
      }

      /* Timer Section */
      .timer-section {
        background: linear-gradient(
          145deg,
          var(--metal-gray),
          var(--metal-dark)
        );
        border: 2px solid var(--blood-red);
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 16px;
        text-align: center;
      }

      .timer-display {
        font-family: "Metal", Impact, sans-serif;
        font-size: 48px;
        color: var(--fire-orange);
        text-shadow: 0 0 20px rgba(255, 136, 0, 0.5);
        margin: 16px 0;
      }

      .timer-label {
        font-size: 12px;
        color: var(--chrome);
        text-transform: uppercase;
        letter-spacing: 2px;
      }

      .timer-buttons {
        display: flex;
        gap: 12px;
        justify-content: center;
        margin-top: 16px;
      }

      .timer-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        font-family: "Metal", Impact, sans-serif;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .timer-btn.primary {
        background: linear-gradient(
          145deg,
          var(--fire-orange),
          var(--fire-red)
        );
        color: var(--skull-white);
      }

      .timer-btn.secondary {
        background: var(--metal-dark);
        color: var(--skull-white);
        border: 1px solid var(--blood-red);
      }

      .timer-btn:active {
        transform: scale(0.95);
      }

      /* Achievements */
      .achievements-section {
        margin-bottom: 16px;
      }

      .section-title {
        font-family: "Metal", Impact, sans-serif;
        font-size: 16px;
        color: var(--fire-orange);
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .achievements-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
      }

      .achievement {
        aspect-ratio: 1;
        background: var(--metal-dark);
        border: 1px solid var(--blood-red);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        opacity: 0.4;
        filter: grayscale(1);
        transition: all 0.3s;
      }

      .achievement.unlocked {
        opacity: 1;
        filter: grayscale(0);
        border-color: var(--fire-orange);
        box-shadow: 0 0 10px rgba(255, 136, 0, 0.3);
      }

      /* Day Selector Modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.9);
        z-index: 100;
        display: none;
        align-items: center;
        justify-content: center;
        padding: 20px;
      }

      .modal-overlay.active {
        display: flex;
      }

      .modal-content {
        background: var(--metal-gray);
        border: 2px solid var(--blood-red);
        border-radius: 16px;
        padding: 20px;
        max-height: 80vh;
        overflow-y: auto;
        width: 100%;
        max-width: 350px;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .modal-title {
        font-family: "Metal", Impact, sans-serif;
        font-size: 18px;
        color: var(--fire-orange);
      }

      .modal-close {
        width: 32px;
        height: 32px;
        background: var(--metal-dark);
        border: 1px solid var(--blood-red);
        border-radius: 50%;
        color: var(--skull-white);
        font-size: 18px;
        cursor: pointer;
      }

      .days-grid {
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 8px;
      }

      .day-btn {
        aspect-ratio: 1;
        background: var(--metal-dark);
        border: 1px solid var(--blood-red);
        border-radius: 8px;
        color: var(--skull-white);
        font-family: "Metal", Impact, sans-serif;
        font-size: 14px;
        cursor: pointer;
        transition: all 0.2s;
        position: relative;
      }

      .day-btn.completed {
        background: linear-gradient(145deg, var(--fire-red), var(--blood-red));
        border-color: var(--fire-orange);
      }

      .day-btn.current {
        border-color: var(--fire-yellow);
        box-shadow: 0 0 10px var(--fire-yellow);
      }

      .day-btn.locked {
        opacity: 0.4;
      }

      /* Bottom Navigation */
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, transparent, var(--metal-dark) 20%);
        padding: 16px 16px calc(var(--safe-bottom) + 16px);
        z-index: 50;
      }

      .nav-buttons {
        display: flex;
        gap: 12px;
      }

      .nav-btn {
        flex: 1;
        padding: 14px;
        border: none;
        border-radius: 12px;
        font-family: "Metal", Impact, sans-serif;
        font-size: 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
      }

      .nav-btn.primary {
        background: linear-gradient(
          145deg,
          var(--fire-orange),
          var(--fire-red)
        );
        color: var(--skull-white);
      }

      .nav-btn.secondary {
        background: var(--metal-gray);
        color: var(--skull-white);
        border: 1px solid var(--blood-red);
      }

      .nav-btn-icon {
        font-size: 20px;
      }

      /* Streak Animation */
      .streak-fire {
        animation: pulse-fire 1s ease-in-out infinite;
      }

      @keyframes pulse-fire {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
      }

      /* XP Popup */
      .xp-popup {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: linear-gradient(
          145deg,
          var(--fire-orange),
          var(--fire-red)
        );
        padding: 20px 40px;
        border-radius: 16px;
        font-family: "Metal", Impact, sans-serif;
        font-size: 24px;
        color: var(--skull-white);
        z-index: 200;
        animation: xp-appear 0.5s ease;
        display: none;
      }

      .xp-popup.active {
        display: block;
      }

      @keyframes xp-appear {
        0% {
          transform: translate(-50%, -50%) scale(0);
          opacity: 0;
        }
        50% {
          transform: translate(-50%, -50%) scale(1.2);
        }
        100% {
          transform: translate(-50%, -50%) scale(1);
          opacity: 1;
        }
      }

      /* Level Up Animation */
      .level-up-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.95);
        z-index: 300;
        display: none;
        align-items: center;
        justify-content: center;
        flex-direction: column;
      }

      .level-up-overlay.active {
        display: flex;
      }

      .level-up-text {
        font-family: "Metal", Impact, sans-serif;
        font-size: 36px;
        background: linear-gradient(
          180deg,
          var(--fire-yellow),
          var(--fire-orange)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: level-pulse 0.5s ease infinite alternate;
      }

      .level-up-rank {
        font-family: "Metal", Impact, sans-serif;
        font-size: 24px;
        color: var(--skull-white);
        margin-top: 16px;
      }

      @keyframes level-pulse {
        0% {
          transform: scale(1);
        }
        100% {
          transform: scale(1.1);
        }
      }

      /* Scrollbar */
      ::-webkit-scrollbar {
        width: 4px;
      }

      ::-webkit-scrollbar-track {
        background: var(--metal-dark);
      }

      ::-webkit-scrollbar-thumb {
        background: var(--blood-red);
        border-radius: 2px;
      }
    </style>
  </head>
  <body>
    <div id="pixi-container"></div>

    <div class="app-container">
      <header class="header">
        <h1 class="logo">SHREDDER</h1>
        <p class="subtitle">30 DAGARS GITARRTR√ÑNING</p>
      </header>

      <div class="stats-bar">
        <div class="stat-box">
          <span class="stat-icon streak-fire" id="streak-icon">üî•</span>
          <div class="stat-value" id="streak-value">0</div>
          <div class="stat-label">Streak</div>
        </div>
        <div class="stat-box">
          <span class="stat-icon">‚ö°</span>
          <div class="stat-value" id="total-xp">0</div>
          <div class="stat-label">Total XP</div>
        </div>
        <div class="stat-box">
          <span class="stat-icon">‚è±Ô∏è</span>
          <div class="stat-value" id="total-time">0h</div>
          <div class="stat-label">Tid</div>
        </div>
      </div>

      <div class="level-section">
        <div class="level-header">
          <span class="level-title"
            >LEVEL <span id="current-level">1</span></span
          >
          <span class="level-rank" id="current-rank">Nyb√∂rjare</span>
        </div>
        <div class="xp-bar-container">
          <div class="xp-bar" id="xp-bar" style="width: 0%"></div>
        </div>
        <div class="xp-text">
          <span id="level-xp">0</span> /
          <span id="level-xp-needed">100</span> XP
        </div>
      </div>

      <div class="timer-section">
        <div class="timer-label">√ñvningstid idag</div>
        <div class="timer-display" id="timer-display">00:00</div>
        <div class="timer-buttons">
          <button class="timer-btn primary" id="timer-start">‚ñ∂ STARTA</button>
          <button class="timer-btn secondary" id="timer-reset">
            ‚Ü∫ NOLLST√ÑLL
          </button>
        </div>
      </div>

      <div class="day-card" id="day-card">
        <!-- Filled by JS -->
      </div>

      <div class="achievements-section">
        <h3 class="section-title">üèÜ Achievements</h3>
        <div class="achievements-grid" id="achievements-grid">
          <!-- Filled by JS -->
        </div>
      </div>
    </div>

    <div class="bottom-nav">
      <div class="nav-buttons">
        <button class="nav-btn secondary" id="prev-day-btn">
          <span class="nav-btn-icon">‚óÄ</span>
          <span>F√ñRRA</span>
        </button>
        <button class="nav-btn primary" id="select-day-btn">
          <span class="nav-btn-icon">üìÖ</span>
          <span>V√ÑLJ DAG</span>
        </button>
        <button class="nav-btn secondary" id="next-day-btn">
          <span class="nav-btn-icon">‚ñ∂</span>
          <span>N√ÑSTA</span>
        </button>
      </div>
    </div>

    <div class="modal-overlay" id="day-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">V√§lj Dag</h3>
          <button class="modal-close" id="modal-close">√ó</button>
        </div>
        <div class="days-grid" id="days-grid">
          <!-- Filled by JS -->
        </div>
      </div>
    </div>

    <div class="xp-popup" id="xp-popup">+<span id="xp-amount">0</span> XP</div>

    <div class="level-up-overlay" id="level-up-overlay">
      <div class="level-up-text">LEVEL UP!</div>
      <div class="level-up-rank" id="new-rank">Gitarrkrigar</div>
    </div>

    <script>
      // ============================================
      // COURSE DATA - Loaded from JSON file
      // ============================================
      let GUITARISTS = {};
      let TRAINING_DAYS = [];
      let LEVELS = [];
      let ACHIEVEMENTS = [];

      // Load course data from JSON file
      async function loadCourseData() {
        try {
          const response = await fetch("course-data.json");
          if (!response.ok) {
            throw new Error(`Failed to load course data: ${response.status}`);
          }
          const data = await response.json();

          GUITARISTS = data.guitarists;
          TRAINING_DAYS = data.days;
          LEVELS = data.levels;

          // Create achievements with condition functions
          ACHIEVEMENTS = data.achievements.map((ach) => ({
            ...ach,
            condition: (s) => s[ach.type] >= ach.value,
          }));

          console.log("Course data loaded successfully");
          return true;
        } catch (error) {
          console.error("Error loading course data:", error);
          // Show error to user
          document.body.innerHTML = `
                <div style="display:flex;align-items:center;justify-content:center;height:100vh;background:#0a0505;color:#ff4400;font-family:sans-serif;text-align:center;padding:20px;">
                    <div>
                        <h1>‚ö†Ô∏è Kunde inte ladda kursdata</h1>
                        <p style="color:#c0c0c0;">Kontrollera att course-data.json finns och ladda om sidan.</p>
                        <p style="color:#888;font-size:12px;">${error.message}</p>
                    </div>
                </div>
            `;
          return false;
        }
      }

      // ============================================
      // APP STATE
      // ============================================
      const STORAGE_KEY = "shredder_progress";
      const START_DATE = new Date("2025-12-30");

      let state = {
        currentDay: 1,
        totalXP: 0,
        streak: 0,
        maxStreak: 0,
        totalMinutes: 0,
        daysCompleted: 0,
        completedExercises: {},
        dailyPracticeTime: {},
        lastPracticeDate: null,
        achievements: [],
      };

      let timerInterval = null;
      let timerSeconds = 0;
      let timerRunning = false;

      // ============================================
      // PIXI.JS FIRE BACKGROUND
      // ============================================
      let pixiApp;
      const particles = [];

      function initPixi() {
        const container = document.getElementById("pixi-container");
        pixiApp = new PIXI.Application({
          width: window.innerWidth,
          height: window.innerHeight,
          backgroundColor: 0x0a0505,
          resolution: window.devicePixelRatio || 1,
          autoDensity: true,
        });
        container.appendChild(pixiApp.view);

        // Create fire particles
        for (let i = 0; i < 50; i++) {
          createParticle();
        }

        // Create pixelated skulls
        for (let i = 0; i < 5; i++) {
          createSkull();
        }

        pixiApp.ticker.add(updateParticles);

        window.addEventListener("resize", () => {
          pixiApp.renderer.resize(window.innerWidth, window.innerHeight);
        });
      }

      function createParticle() {
        const particle = new PIXI.Graphics();
        const size = Math.random() * 6 + 2;
        const colors = [0xff4400, 0xff8800, 0xffcc00, 0xff2200];
        const color = colors[Math.floor(Math.random() * colors.length)];

        particle.beginFill(color, Math.random() * 0.5 + 0.2);
        particle.drawRect(0, 0, size, size);
        particle.endFill();

        particle.x = Math.random() * window.innerWidth;
        particle.y = window.innerHeight + Math.random() * 100;
        particle.vx = (Math.random() - 0.5) * 2;
        particle.vy = -(Math.random() * 3 + 1);
        particle.life = Math.random() * 100 + 50;
        particle.maxLife = particle.life;

        pixiApp.stage.addChild(particle);
        particles.push(particle);
      }

      function createSkull() {
        const skull = new PIXI.Graphics();
        const x = Math.random() * window.innerWidth;
        const y = Math.random() * window.innerHeight;
        const size = Math.random() * 20 + 15;

        // Pixelated skull shape
        skull.beginFill(0x1a1010, 0.3);
        // Head
        skull.drawRect(x + size * 0.2, y, size * 0.6, size * 0.1);
        skull.drawRect(x + size * 0.1, y + size * 0.1, size * 0.8, size * 0.1);
        skull.drawRect(x, y + size * 0.2, size, size * 0.4);
        // Eyes
        skull.beginFill(0x0a0505, 0.5);
        skull.drawRect(
          x + size * 0.15,
          y + size * 0.3,
          size * 0.25,
          size * 0.15,
        );
        skull.drawRect(
          x + size * 0.6,
          y + size * 0.3,
          size * 0.25,
          size * 0.15,
        );
        // Nose
        skull.drawRect(x + size * 0.4, y + size * 0.5, size * 0.2, size * 0.1);
        // Jaw
        skull.beginFill(0x1a1010, 0.3);
        skull.drawRect(x + size * 0.1, y + size * 0.6, size * 0.8, size * 0.2);
        skull.drawRect(x + size * 0.2, y + size * 0.8, size * 0.6, size * 0.1);
        skull.endFill();

        skull.alpha = 0.15;
        skull.vy = Math.random() * 0.3 + 0.1;

        pixiApp.stage.addChild(skull);
        particles.push(skull);
      }

      function updateParticles() {
        particles.forEach((p, i) => {
          if (p.life !== undefined) {
            p.x += p.vx;
            p.y += p.vy;
            p.life--;
            p.alpha = (p.life / p.maxLife) * 0.5;

            if (p.life <= 0) {
              p.x = Math.random() * window.innerWidth;
              p.y = window.innerHeight + 20;
              p.life = p.maxLife;
              p.alpha = 0.5;
            }
          } else if (p.vy) {
            p.y += p.vy;
            if (p.y > window.innerHeight + 50) {
              p.y = -50;
              p.x = Math.random() * window.innerWidth;
            }
          }
        });
      }

      // ============================================
      // STORAGE
      // ============================================
      function loadState() {
        try {
          const saved = localStorage.getItem(STORAGE_KEY);
          if (saved) {
            state = { ...state, ...JSON.parse(saved) };
          }
        } catch (e) {
          console.error("Failed to load state:", e);
        }

        // Calculate current day based on date
        const today = new Date();
        const daysDiff =
          Math.floor((today - START_DATE) / (1000 * 60 * 60 * 24)) + 1;
        state.currentDay = Math.max(1, Math.min(30, daysDiff));

        // Check streak
        checkStreak();

        // Load today's timer
        const todayKey = getDateKey(new Date());
        timerSeconds = (state.dailyPracticeTime[todayKey] || 0) * 60;
      }

      function saveState() {
        try {
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
        } catch (e) {
          console.error("Failed to save state:", e);
        }
      }

      function getDateKey(date) {
        return date.toISOString().split("T")[0];
      }

      function checkStreak() {
        const today = getDateKey(new Date());
        const yesterday = getDateKey(new Date(Date.now() - 86400000));

        if (state.lastPracticeDate === today) {
          // Already practiced today
        } else if (state.lastPracticeDate === yesterday) {
          // Streak continues
        } else if (state.lastPracticeDate !== null) {
          // Streak broken
          state.streak = 0;
        }
      }

      // ============================================
      // GAMIFICATION
      // ============================================
      function addXP(amount) {
        const oldLevel = getCurrentLevel();
        state.totalXP += amount;
        const newLevel = getCurrentLevel();

        saveState();
        updateUI();

        // Show XP popup
        showXPPopup(amount);

        // Check level up
        if (newLevel.level > oldLevel.level) {
          setTimeout(() => showLevelUp(newLevel), 800);
        }

        // Check achievements
        checkAchievements();

        // Trigger particle burst
        triggerParticleBurst();
      }

      function getCurrentLevel() {
        for (let i = LEVELS.length - 1; i >= 0; i--) {
          if (state.totalXP >= LEVELS[i].xp) {
            return LEVELS[i];
          }
        }
        return LEVELS[0];
      }

      function getNextLevel() {
        const current = getCurrentLevel();
        const nextIndex =
          LEVELS.findIndex((l) => l.level === current.level) + 1;
        return LEVELS[nextIndex] || LEVELS[LEVELS.length - 1];
      }

      function showXPPopup(amount) {
        const popup = document.getElementById("xp-popup");
        document.getElementById("xp-amount").textContent = amount;
        popup.classList.add("active");
        setTimeout(() => popup.classList.remove("active"), 1500);
      }

      function showLevelUp(level) {
        const overlay = document.getElementById("level-up-overlay");
        document.getElementById("new-rank").textContent = level.rank;
        overlay.classList.add("active");
        setTimeout(() => overlay.classList.remove("active"), 3000);
      }

      function checkAchievements() {
        ACHIEVEMENTS.forEach((ach) => {
          if (!state.achievements.includes(ach.id) && ach.condition(state)) {
            state.achievements.push(ach.id);
            saveState();
          }
        });
        renderAchievements();
      }

      function triggerParticleBurst() {
        for (let i = 0; i < 20; i++) {
          const particle = new PIXI.Graphics();
          const size = Math.random() * 8 + 4;
          const colors = [0xff4400, 0xff8800, 0xffcc00];
          const color = colors[Math.floor(Math.random() * colors.length)];

          particle.beginFill(color, 0.8);
          particle.drawRect(0, 0, size, size);
          particle.endFill();

          particle.x = window.innerWidth / 2;
          particle.y = window.innerHeight / 2;
          particle.vx = (Math.random() - 0.5) * 15;
          particle.vy = (Math.random() - 0.5) * 15;
          particle.life = 30;
          particle.maxLife = 30;

          pixiApp.stage.addChild(particle);
          particles.push(particle);
        }
      }

      // ============================================
      // TIMER
      // ============================================
      function startTimer() {
        if (timerRunning) {
          pauseTimer();
          return;
        }

        timerRunning = true;
        document.getElementById("timer-start").textContent = "‚è∏ PAUS";

        timerInterval = setInterval(() => {
          timerSeconds++;
          updateTimerDisplay();

          // Save every minute
          if (timerSeconds % 60 === 0) {
            savePracticeTime();
          }
        }, 1000);
      }

      function pauseTimer() {
        timerRunning = false;
        clearInterval(timerInterval);
        document.getElementById("timer-start").textContent = "‚ñ∂ STARTA";
        savePracticeTime();
      }

      function resetTimer() {
        pauseTimer();
        timerSeconds = 0;
        updateTimerDisplay();

        const todayKey = getDateKey(new Date());
        state.dailyPracticeTime[todayKey] = 0;
        saveState();
      }

      function updateTimerDisplay() {
        const mins = Math.floor(timerSeconds / 60);
        const secs = timerSeconds % 60;
        document.getElementById("timer-display").textContent =
          `${mins.toString().padStart(2, "0")}:${secs.toString().padStart(2, "0")}`;
      }

      function savePracticeTime() {
        const todayKey = getDateKey(new Date());
        const minutes = Math.floor(timerSeconds / 60);

        state.dailyPracticeTime[todayKey] = minutes;
        state.totalMinutes = Object.values(state.dailyPracticeTime).reduce(
          (a, b) => a + b,
          0,
        );

        // Update last practice date and streak
        if (minutes > 0) {
          const wasToday = state.lastPracticeDate === todayKey;
          const yesterday = getDateKey(new Date(Date.now() - 86400000));

          if (!wasToday) {
            if (
              state.lastPracticeDate === yesterday ||
              state.lastPracticeDate === null
            ) {
              state.streak++;
            } else {
              state.streak = 1;
            }
            state.maxStreak = Math.max(state.maxStreak, state.streak);
          }
          state.lastPracticeDate = todayKey;
        }

        saveState();
        updateUI();
        checkAchievements();
      }

      // ============================================
      // DAY COMPLETION
      // ============================================
      const DAY_XP = 100; // XP per completed day

      function toggleDayComplete(dayIndex) {
        const key = `day-${dayIndex}`;

        if (!state.completedExercises[key]) {
          state.completedExercises[key] = true;
          state.daysCompleted++;
          addXP(DAY_XP);
          checkAchievements();
        }

        saveState();
        renderDayCard();
      }

      function isDayCompleted(dayIndex) {
        return state.completedExercises[`day-${dayIndex}`] === true;
      }

      // ============================================
      // UI RENDERING
      // ============================================
      function updateUI() {
        // Stats
        document.getElementById("streak-value").textContent = state.streak;
        document.getElementById("total-xp").textContent = state.totalXP;

        const hours = Math.floor(state.totalMinutes / 60);
        const mins = state.totalMinutes % 60;
        document.getElementById("total-time").textContent =
          hours > 0 ? `${hours}h${mins}m` : `${mins}m`;

        // Level
        const level = getCurrentLevel();
        const nextLevel = getNextLevel();
        document.getElementById("current-level").textContent = level.level;
        document.getElementById("current-rank").textContent = level.rank;

        const xpInLevel = state.totalXP - level.xp;
        const xpNeeded = nextLevel.xp - level.xp;
        const progress = Math.min(100, (xpInLevel / xpNeeded) * 100);

        document.getElementById("xp-bar").style.width = `${progress}%`;
        document.getElementById("level-xp").textContent = xpInLevel;
        document.getElementById("level-xp-needed").textContent = xpNeeded;

        // Streak fire animation
        const streakIcon = document.getElementById("streak-icon");
        if (state.streak > 0) {
          streakIcon.classList.add("streak-fire");
        } else {
          streakIcon.classList.remove("streak-fire");
        }
      }

      function renderDayCard() {
        const dayData = TRAINING_DAYS[state.currentDay - 1];
        const guitarist = GUITARISTS[dayData.guitarist];
        const isCompleted = isDayCompleted(state.currentDay - 1);

        // Calculate date for this day
        const dayDate = new Date(START_DATE);
        dayDate.setDate(dayDate.getDate() + dayData.day - 1);
        const dateStr = dayDate.toLocaleDateString("sv-SE", {
          day: "numeric",
          month: "short",
        });

        // Calculate week number
        const weekNum = Math.ceil(dayData.day / 6);

        // Warmup section
        const warmupHTML = dayData.warmup
          .map((item) => `<li>${item}</li>`)
          .join("");

        // Technique focus section
        const techniqueHTML = dayData.techniqueFocus
          .map((item) => `<li>${item}</li>`)
          .join("");

        document.getElementById("day-card").innerHTML = `
            <div class="day-header">
                <div>
                    <div class="day-number">DAG ${dayData.day}</div>
                    <div class="day-date">${dateStr} ‚Ä¢ Vecka ${weekNum}</div>
                </div>
                <div class="guitarist-badge" style="border-color: ${guitarist.color}">
                    <div class="guitarist-avatar">${guitarist.emoji}</div>
                    <div class="guitarist-name" style="color: ${guitarist.color}">${guitarist.name}</div>
                </div>
            </div>
            <h3 class="day-title">${dayData.title}</h3>

            <div class="training-section">
                <div class="training-section-title">üî• Uppv√§rmning</div>
                <ul class="training-list">
                    ${warmupHTML}
                </ul>
            </div>

            <div class="training-section">
                <div class="training-section-title">üéØ Teknikfokus</div>
                <ul class="training-list">
                    ${techniqueHTML}
                </ul>
            </div>

            <div class="training-section">
                <div class="training-section-title">üé∏ Dagens Lick</div>
                <div class="lick-section">
                    <pre class="lick-tab">${dayData.lick}</pre>
                </div>
            </div>

            <div class="quote-section">
                <p class="quote-text">"${dayData.quote}"</p>
                <p class="quote-author">‚Äî ${guitarist.name}</p>
            </div>

            <button class="complete-day-btn ${isCompleted ? "completed" : "incomplete"}"
                    onclick="toggleDayComplete(${state.currentDay - 1})"
                    ${isCompleted ? "disabled" : ""}>
                ${isCompleted ? "‚úì DAG AVKLARAD" : "MARKERA SOM AVKLARAD"}
                <span class="xp-badge">+${DAY_XP} XP</span>
            </button>
        `;
      }

      function renderAchievements() {
        const grid = document.getElementById("achievements-grid");
        grid.innerHTML = ACHIEVEMENTS.map(
          (ach) => `
            <div class="achievement ${state.achievements.includes(ach.id) ? "unlocked" : ""}"
                 title="${ach.name}">
                ${ach.emoji}
            </div>
        `,
        ).join("");
      }

      function renderDaysGrid() {
        const grid = document.getElementById("days-grid");
        const today = new Date();

        grid.innerHTML = TRAINING_DAYS.map((day, i) => {
          const dayDate = new Date(START_DATE);
          dayDate.setDate(dayDate.getDate() + i);

          const isCompleted = isDayCompleted(i);
          const isCurrent = i + 1 === state.currentDay;

          // Check if all previous days are completed
          const prevDaysCompleted =
            i === 0
              ? true
              : Array.from({ length: i }, (_, j) => isDayCompleted(j)).every(
                  Boolean,
                );

          // Day 1 can be accessed 1 day early, others need correct date
          const dateUnlocked = i === 0 ? true : dayDate <= today;

          // Locked if date not reached OR previous days not completed
          const isLocked = !dateUnlocked || !prevDaysCompleted;

          return `
                <button class="day-btn ${isCompleted ? "completed" : ""} ${isCurrent ? "current" : ""} ${isLocked ? "locked" : ""}"
                        onclick="selectDay(${i + 1})" ${isLocked ? "disabled" : ""}>
                    ${i + 1}
                </button>
            `;
        }).join("");
      }

      // ============================================
      // NAVIGATION
      // ============================================
      function selectDay(day) {
        state.currentDay = day;
        renderDayCard();
        closeModal();
      }

      function prevDay() {
        if (state.currentDay > 1) {
          state.currentDay--;
          renderDayCard();
        }
      }

      function nextDay() {
        const today = new Date();
        const nextDayIndex = state.currentDay; // 0-indexed for next day

        if (nextDayIndex >= 30) return;

        // Check if next day's date is unlocked
        const nextDayDate = new Date(START_DATE);
        nextDayDate.setDate(nextDayDate.getDate() + nextDayIndex);
        const dateUnlocked = nextDayDate <= today;

        // Check if all previous days completed
        const prevDaysCompleted = Array.from({ length: nextDayIndex }, (_, j) =>
          isDayCompleted(j),
        ).every(Boolean);

        if (dateUnlocked && prevDaysCompleted) {
          state.currentDay++;
          renderDayCard();
        }
      }

      function openModal() {
        renderDaysGrid();
        document.getElementById("day-modal").classList.add("active");
      }

      function closeModal() {
        document.getElementById("day-modal").classList.remove("active");
      }

      // ============================================
      // INIT
      // ============================================
      async function init() {
        // Load course data first
        const dataLoaded = await loadCourseData();
        if (!dataLoaded) return;

        loadState();
        initPixi();
        updateUI();
        renderDayCard();
        renderAchievements();
        updateTimerDisplay();

        // Event listeners
        document
          .getElementById("timer-start")
          .addEventListener("click", startTimer);
        document
          .getElementById("timer-reset")
          .addEventListener("click", resetTimer);
        document
          .getElementById("prev-day-btn")
          .addEventListener("click", prevDay);
        document
          .getElementById("next-day-btn")
          .addEventListener("click", nextDay);
        document
          .getElementById("select-day-btn")
          .addEventListener("click", openModal);
        document
          .getElementById("modal-close")
          .addEventListener("click", closeModal);
        document.getElementById("day-modal").addEventListener("click", (e) => {
          if (e.target === document.getElementById("day-modal")) closeModal();
        });

        // Level up overlay click to dismiss
        document
          .getElementById("level-up-overlay")
          .addEventListener("click", () => {
            document
              .getElementById("level-up-overlay")
              .classList.remove("active");
          });
      }

      // Make functions global for onclick handlers
      window.toggleDayComplete = toggleDayComplete;
      window.selectDay = selectDay;

      // Start app
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
